/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return n};var r,n={},o=Object.prototype,a=o.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(r){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),c=new I(n||[]);return i(a,"_invoke",{value:T(t,r,c)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}n.wrap=h;var d="suspendedStart",y="suspendedYield",v="executing",m="completed",g={};function b(){}function w(){}function E(){}var x={};f(x,u,(function(){return this}));var S=Object.getPrototypeOf,L=S&&S(S(M([])));L&&L!==o&&a.call(L,u)&&(x=L);var k=E.prototype=b.prototype=Object.create(x);function O(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function j(e,r){function n(o,i,c,u){var s=p(e[o],e,i);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==t(f)&&a.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,c,u)}),(function(t){n("throw",t,c,u)})):r.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return n("throw",t,c,u)}))}u(s.arg)}var o;i(this,"_invoke",{value:function(t,e){function a(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(a,a):a()}})}function T(t,e,n){var o=d;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:r,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(t,e,n);if("normal"===s.type){if(o=n.done?m:y,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function P(t,e){var n=e.method,o=t.iterator[n];if(o===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=r,P(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,g;var i=a.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,g):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,g)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(a.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return w.prototype=E,i(k,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:w,configurable:!0}),w.displayName=f(E,l,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,f(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},n.awrap=function(t){return{__await:t}},O(j.prototype),f(j.prototype,s,(function(){return this})),n.AsyncIterator=j,n.async=function(t,e,r,o,a){void 0===a&&(a=Promise);var i=new j(h(t,e,r,o),a);return n.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(k),f(k,l,"Generator"),f(k,u,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},n.values=M,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,o){return c.type="throw",c.arg=t,e.next=n,o&&(e.method="next",e.arg=r),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),s=a.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:M(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),g}},n}function r(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function n(t){return function(){var e=this,n=arguments;return new Promise((function(o,a){var i=t.apply(e,n);function c(t){r(i,o,a,c,u,"next",t)}function u(t){r(i,o,a,c,u,"throw",t)}c(void 0)}))}}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function a(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var i=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},r=[{key:"get",value:(u=n(e().mark((function t(r){var n;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(r);case 3:if(401!==(n=t.sent).status){t.next=7;break}return window.location.href="/login",t.abrupt("return",{success:!1,message:"Authentication required"});case 7:if(n.ok){t.next=9;break}throw new Error("API Error: ".concat(n.statusText));case 9:return t.next=11,n.json();case 11:return t.abrupt("return",t.sent);case 14:return t.prev=14,t.t0=t.catch(0),console.error("GET ".concat(r," failed:"),t.t0),t.abrupt("return",{success:!1,message:t.t0.message});case 18:case"end":return t.stop()}}),t,null,[[0,14]])}))),function(t){return u.apply(this,arguments)})},{key:"post",value:(c=n(e().mark((function t(r,n){var o;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 3:if(401!==(o=t.sent).status){t.next=7;break}return window.location.href="/login",t.abrupt("return",{success:!1,message:"Authentication required"});case 7:if(o.ok){t.next=9;break}throw new Error("API Error: ".concat(o.statusText));case 9:return t.next=11,o.json();case 11:return t.abrupt("return",t.sent);case 14:return t.prev=14,t.t0=t.catch(0),console.error("POST ".concat(r," failed:"),t.t0),t.abrupt("return",{success:!1,message:t.t0.message});case 18:case"end":return t.stop()}}),t,null,[[0,14]])}))),function(t,e){return c.apply(this,arguments)})},{key:"put",value:(i=n(e().mark((function t(r,n){var o;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(r,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 3:if(401!==(o=t.sent).status){t.next=7;break}return window.location.href="/login",t.abrupt("return",{success:!1,message:"Authentication required"});case 7:if(o.ok){t.next=9;break}throw new Error("API Error: ".concat(o.statusText));case 9:return t.next=11,o.json();case 11:return t.abrupt("return",t.sent);case 14:return t.prev=14,t.t0=t.catch(0),console.error("PUT ".concat(r," failed:"),t.t0),t.abrupt("return",{success:!1,message:t.t0.message});case 18:case"end":return t.stop()}}),t,null,[[0,14]])}))),function(t,e){return i.apply(this,arguments)})},{key:"delete",value:(a=n(e().mark((function t(r){var n;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(r,{method:"DELETE",headers:{"Content-Type":"application/json"}});case 3:if(401!==(n=t.sent).status){t.next=7;break}return window.location.href="/login",t.abrupt("return",{success:!1,message:"Authentication required"});case 7:if(n.ok){t.next=9;break}throw new Error("API Error: ".concat(n.statusText));case 9:return t.next=11,n.json();case 11:return t.abrupt("return",t.sent);case 14:return t.prev=14,t.t0=t.catch(0),console.error("DELETE ".concat(r," failed:"),t.t0),t.abrupt("return",{success:!1,message:t.t0.message});case 18:case"end":return t.stop()}}),t,null,[[0,14]])}))),function(t){return a.apply(this,arguments)})}],r&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,a,i,c,u}();function c(t){if(!t)return"";var e=new Date(t);if(isNaN(e.getTime()))return console.error("Invalid date:",t),"";var r=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(r,"-").concat(n,"-").concat(o)}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach((function(e){f(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function f(t,e,r){return(e=v(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function h(){h=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),c=new I(n||[]);return o(i,"_invoke",{value:T(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var d="suspendedStart",y="suspendedYield",v="executing",m="completed",g={};function b(){}function w(){}function E(){}var x={};l(x,i,(function(){return this}));var S=Object.getPrototypeOf,L=S&&S(S(M([])));L&&L!==r&&n.call(L,i)&&(x=L);var k=E.prototype=b.prototype=Object.create(x);function O(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,a,i,c){var s=p(t[o],t,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==u(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(f).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,c)}))}c(s.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function T(e,r,n){var o=d;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?m:y,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function M(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(u(e)+" is not iterable")}return w.prototype=E,o(k,"constructor",{value:E,configurable:!0}),o(E,"constructor",{value:w,configurable:!0}),w.displayName=l(E,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,l(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(j.prototype),l(j.prototype,c,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new j(f(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(k),l(k,s,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:M(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function p(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function d(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){p(a,n,o,i,c,"next",t)}function c(t){p(a,n,o,i,c,"throw",t)}i(void 0)}))}}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,v(n.key),n)}}function v(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}var m=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.uiManager=e,this.methodsCache=[],this.companiesCache=[],this.api=new i},e=[{key:"fetchMethods",value:(p=d(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.get("/api/methods");case 3:(e=t.sent).success?this.methodsCache=e.data||["UT","UTT","RT","MT","PT"]:(console.error("Error fetching methods:",e.message),this.methodsCache=["UT","UTT","RT","MT","PT"]),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error fetching methods:",t.t0),this.methodsCache=["UT","UTT","RT","MT","PT"];case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return p.apply(this,arguments)})},{key:"fetchCompanies",value:(f=d(h().mark((function t(){var e;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.get("/api/companies");case 3:(e=t.sent).success?this.companiesCache=e.data||["Mistras","Company B"]:(console.error("Error fetching companies:",e.message),this.companiesCache=["Mistras","Company B"]),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error fetching companies:",t.t0),this.companiesCache=["Mistras","Company B"];case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return f.apply(this,arguments)})},{key:"fetchEntries",value:(s=d(h().mark((function t(){var e,r,n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.get("/api/entries");case 3:if((e=t.sent).success){t.next=7;break}return console.error("Error fetching entries:",e.message),t.abrupt("return");case 7:r=e.data,n=r.map((function(t){return l(l({},t),{},{formattedDate:c(t.entry_date)})})),this.uiManager.renderEntries(n,this.methodsCache,this.companiesCache),this.uiManager.updateTotals(),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),console.error("Error fetching entries:",t.t0);case 16:case"end":return t.stop()}}),t,this,[[0,13]])}))),function(){return s.apply(this,arguments)})},{key:"addNewEntry",value:(u=d(h().mark((function t(){var e,r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.post("/api/entries",{empty:!0});case 3:if((e=t.sent).success){t.next=7;break}return alert("Error adding blank entry to database."),t.abrupt("return");case 7:r={id:e.insertedId,entry_date:null,method:"",location:"",hours:0,company:"",formattedDate:""},this.uiManager.addEntryRow(r,this.methodsCache,this.companiesCache),this.uiManager.updateTotals(),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error adding new entry:",t.t0),alert("Failed to add new entry. Please try again.");case 16:case"end":return t.stop()}}),t,this,[[0,12]])}))),function(){return u.apply(this,arguments)})},{key:"updateEntry",value:(a=d(h().mark((function t(e,r){var n;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.put("/api/entries/".concat(e),r);case 3:if((n=t.sent).success){t.next=7;break}return console.error("Update failed:",n.message),t.abrupt("return",!1);case 7:return this.uiManager.updateTotals(),t.abrupt("return",!0);case 11:return t.prev=11,t.t0=t.catch(0),console.error("Error updating entry:",t.t0),t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(t,e){return a.apply(this,arguments)})},{key:"deleteEntry",value:(o=d(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}return t.abrupt("return",!0);case 3:if(confirm("Are you sure you want to delete this entry? This cannot be undone.")){t.next=5;break}return t.abrupt("return",!1);case 5:return t.next=7,this.api.delete("/api/entries/".concat(e));case 7:if((r=t.sent).success){t.next=11;break}return alert("Failed to delete entry: "+(r.message||"Unknown error")),t.abrupt("return",!1);case 11:return this.uiManager.updateTotals(),t.abrupt("return",!0);case 15:return t.prev=15,t.t0=t.catch(0),console.error("Error deleting entry:",t.t0),alert("Network error when trying to delete entry. Please try again."),t.abrupt("return",!1);case 20:case"end":return t.stop()}}),t,this,[[0,15]])}))),function(t){return o.apply(this,arguments)})},{key:"addMethod",value:(n=d(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,this.api.post("/api/methods",{methodName:e});case 5:if((r=t.sent).success){t.next=9;break}return alert("Error adding method: "+(r.message||"Unknown error")),t.abrupt("return",!1);case 9:return this.methodsCache.includes(e)||(this.methodsCache.push(e),this.methodsCache.sort()),this.uiManager.updateMethodSelects(this.methodsCache),t.abrupt("return",!0);case 14:return t.prev=14,t.t0=t.catch(0),console.error("Error adding method:",t.t0),alert("Error adding method."),t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t,this,[[0,14]])}))),function(t){return n.apply(this,arguments)})},{key:"addCompany",value:(r=d(h().mark((function t(e){var r;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,this.api.post("/api/companies",{companyName:e});case 5:if((r=t.sent).success){t.next=9;break}return alert("Error adding company: "+(r.message||"Unknown error")),t.abrupt("return",!1);case 9:return this.companiesCache.includes(e)||(this.companiesCache.push(e),this.companiesCache.sort()),this.uiManager.updateCompanySelects(this.companiesCache),t.abrupt("return",!0);case 14:return t.prev=14,t.t0=t.catch(0),console.error("Error adding company:",t.t0),alert("Error adding company."),t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t,this,[[0,14]])}))),function(t){return r.apply(this,arguments)})},{key:"getEntryDataFromRow",value:function(t){return{entryDate:t.cells[1].querySelector('input[type="date"]').value,method:t.cells[2].querySelector("select").value,location:t.cells[3].querySelector('input[type="text"]').value,hours:parseFloat(t.cells[4].querySelector('input[type="number"]').value)||0,company:t.cells[5].querySelector("select").value}}},{key:"calculateTotals",value:function(){var t=document.querySelectorAll("#trackerTable tbody tr"),e=0,r={};return t.forEach((function(t){var n=t.querySelector(".methodSelect"),o=t.querySelector('input[type="number"]');if(n&&o){var a=n.value,i=parseFloat(o.value)||0;a&&"ADD METHOD"!==a&&(e+=i,r[a]||(r[a]=0),r[a]+=i)}})),{totalHours:e,methodTotals:r}}}],e&&y(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,a,u,s,f,p}();function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function b(){b=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof m?e:m,i=Object.create(a.prototype),c=new I(n||[]);return o(i,"_invoke",{value:T(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function w(){}function E(){}var x={};s(x,i,(function(){return this}));var S=Object.getPrototypeOf,L=S&&S(S(M([])));L&&L!==r&&n.call(L,i)&&(x=L);var k=E.prototype=m.prototype=Object.create(x);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==g(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function T(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function P(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function M(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(g(e)+" is not iterable")}return w.prototype=E,o(k,"constructor",{value:E,configurable:!0}),o(E,"constructor",{value:w,configurable:!0}),w.displayName=s(E,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,s(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,c,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new j(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(k),s(k,u,"Generator"),s(k,i,(function(){return this})),s(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:M(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function E(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){x(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function x(t,e,r){return(e=O(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function S(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function L(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){S(a,n,o,i,c,"next",t)}function c(t){S(a,n,o,i,c,"throw",t)}i(void 0)}))}}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,O(n.key),n)}}function O(t){var e=function(t){if("object"!=g(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}var j=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.uiManager=e,this.api=new i,this.currentRow=null},e=[{key:"openSignatureModal",value:function(t){this.currentRow=t,document.getElementById("signatureModal").style.display="block"}},{key:"requestSignature",value:(o=L(b().mark((function t(e){var r,n,o,a,i;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.currentRow){t.next=4;break}return alert("Error: No row selected for signature"),t.abrupt("return",!1);case 4:return r=this.currentRow.dataset.entryId||null,n=this.currentRow.querySelector(".methodSelect").value,o=this.currentRow.querySelector('input[type="number"]').value,a=E({entryId:r,method:n,hours:o},e),t.next=10,this.api.post("/api/signatures/request",a);case 10:if((i=t.sent).success){t.next=14;break}return alert("Error sending signature request: "+(i.message||"Unknown error")),t.abrupt("return",!1);case 14:return this.currentRow.dataset.signatureID=i.insertedID,alert("Signature request email sent successfully!"),t.abrupt("return",!0);case 19:return t.prev=19,t.t0=t.catch(0),console.error("Error requesting signature:",t.t0),alert("Error sending signature request."),t.abrupt("return",!1);case 24:case"end":return t.stop()}}),t,this,[[0,19]])}))),function(t){return o.apply(this,arguments)})},{key:"showVerificationDetails",value:(n=L(b().mark((function t(e){var r,n,o,a,i,c;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.signatureId,n=e.method,o=e.hours,a=e.supervisor,i=e.timestampHash,document.getElementById("verifyMethod").textContent=n,document.getElementById("verifyHours").textContent=o,document.getElementById("verifySupervisor").textContent=a,document.getElementById("verifyDate").textContent="Loading...",document.getElementById("verifyHash").textContent=i||"No hash available",document.getElementById("verificationModal").style.display="block",!r){t.next=19;break}return t.prev=8,t.next=11,this.api.get("/api/signatures/verify/".concat(r));case 11:(c=t.sent).success&&(document.getElementById("verifyDate").textContent=new Date(c.verification_date).toLocaleDateString()),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(8),console.error("Error fetching verification details:",t.t0),document.getElementById("verifyDate").textContent="Date unavailable";case 19:case"end":return t.stop()}}),t,this,[[8,15]])}))),function(t){return n.apply(this,arguments)})},{key:"refreshSignatures",value:(r=L(b().mark((function t(){var e,r;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.get("/api/signatures");case 3:if((e=t.sent).success){t.next=7;break}return console.error("Error fetching signatures:",e.message),t.abrupt("return");case 7:r=e.data||[],console.log("Received signatures:",r),this.uiManager.updateSignatures(r),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error refreshing signatures:",t.t0);case 15:case"end":return t.stop()}}),t,this,[[0,12]])}))),function(){return r.apply(this,arguments)})},{key:"disableSignedRow",value:function(t){this.uiManager.disableSignedRow(t)}}],e&&k(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o}();function T(t){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T(t)}function P(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function C(){C=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof m?e:m,i=Object.create(a.prototype),c=new I(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function b(){}var w={};s(w,i,(function(){return this}));var E=Object.getPrototypeOf,x=E&&E(E(M([])));x&&x!==r&&n.call(x,i)&&(w=x);var S=b.prototype=m.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==T(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function M(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(T(e)+" is not iterable")}return g.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},L(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(S),s(S,u,"Generator"),s(S,i,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:M(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function I(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,N(n.key),n)}}function N(t){var e=function(t){if("object"!=T(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==T(e)?e:e+""}var D=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.api=new i,this.eventHandlers={},this.currentMethodSelect=null,this.currentCompanySelect=null},e=[{key:"initializeEventListeners",value:function(t){this.eventHandlers=t,document.getElementById("logoutBtn").addEventListener("click",t.onLogout),document.getElementById("addLineBtn").addEventListener("click",t.onAddLine),document.getElementById("exportPDFBtn").addEventListener("click",t.onExportPDF),document.getElementById("refreshBtn").addEventListener("click",t.onRefreshSignatures),document.addEventListener("change",this.handleTableChanges.bind(this)),document.addEventListener("input",this.handleInputChanges.bind(this)),document.addEventListener("click",this.handleButtonClicks.bind(this)),document.addEventListener("click",(function(t){t.target.closest(".verification-modal .close")&&(document.getElementById("verificationModal").style.display="none"),t.target.classList.contains("verification-modal")&&(t.target.style.display="none")})),this.setupModals(),this.setupSignatureForm()}},{key:"handleTableChanges",value:function(t){if(t.target.classList.contains("methodSelect")){if("ADD METHOD"===t.target.value){var e=prompt("Enter new method:");e&&this.eventHandlers.onAddMethod?(this.currentMethodSelect=t.target,this.eventHandlers.onAddMethod(e)):t.target.value=""}this.updateTotals()}else if(t.target.classList.contains("companySelect")&&"ADD COMPANY"===t.target.value){var r=prompt("Enter new company:");r&&this.eventHandlers.onAddCompany?(this.currentCompanySelect=t.target,this.eventHandlers.onAddCompany(r)):t.target.value=""}var n=t.target.closest("tr");if(n&&n.dataset.entryId){if(n.classList.contains("signed-row"))return alert("This entry has been signed and cannot be modified."),void(t.target.value=t.target.defaultValue);var o=n.dataset.entryId,a=n.cells[1].querySelector('input[type="date"]').value,i=n.cells[2].querySelector("select").value,c=n.cells[3].querySelector('input[type="text"]').value,u=parseFloat(n.cells[4].querySelector('input[type="number"]').value)||0,s=n.cells[5].querySelector("select").value;this.eventHandlers.onUpdateEntry&&(this.eventHandlers.onUpdateEntry(o,{entryDate:a,method:i,location:c,hours:u,company:s}),"INPUT"===t.target.tagName&&(t.target.defaultValue=t.target.value))}}},{key:"handleInputChanges",value:function(t){"number"===t.target.type&&t.target.closest("#trackerTable")&&this.updateTotals()}},{key:"handleButtonClicks",value:function(t){var e=this;if(t.target.classList.contains("delete-btn")){var r=t.target.closest("tr"),n=r.dataset.entryId;this.eventHandlers.onDeleteEntry&&this.eventHandlers.onDeleteEntry(n).then((function(t){t&&(r.remove(),e.updateTotals())}))}if(t.target.classList.contains("signBtn")){var o=t.target.closest("tr");this.eventHandlers.onRequestSignature&&this.eventHandlers.onRequestSignature(o)}if(t.target.classList.contains("verify-btn")){var a=t.target.dataset.signature,i=t.target.dataset.method,c=t.target.dataset.hours,u=t.target.closest("tr").querySelector("td:nth-child(7)").textContent.trim(),s=t.target.dataset.hash;this.eventHandlers.onVerifySignature&&this.eventHandlers.onVerifySignature({signatureId:a,method:i,hours:c,supervisor:u,timestampHash:s})}}},{key:"setupModals",value:function(){document.querySelectorAll(".modal .close").forEach((function(t){t.addEventListener("click",(function(){t.closest(".modal").style.display="none"}))})),window.addEventListener("click",(function(t){t.target.classList.contains("modal")&&(t.target.style.display="none")}))}},{key:"setupSignatureForm",value:function(){var t=this,e=document.getElementById("signatureForm");e&&e.addEventListener("submit",(function(r){r.preventDefault();var n={name:document.getElementById("supervisorName").value,email:document.getElementById("supervisorEmail").value,company:document.getElementById("supervisorCompany").value,asnt:document.getElementById("asnt").value,certLevel:document.getElementById("certLevel").value};t.eventHandlers.onSubmitSignature&&t.eventHandlers.onSubmitSignature(n).then((function(t){t&&(e.reset(),document.getElementById("signatureModal").style.display="none")}))}))}},{key:"fetchUserInfo",value:(r=C().mark((function t(){var e;return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.get("/api/user");case 3:(e=t.sent).success&&(document.getElementById("userDisplay").textContent="Welcome, ".concat(e.user.full_name),document.querySelector("h1").textContent="".concat(e.user.full_name,"'s NDT Hours Tracker")),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error fetching user info:",t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})),n=function(){var t=this,e=arguments;return new Promise((function(n,o){var a=r.apply(t,e);function i(t){I(a,n,o,i,c,"next",t)}function c(t){I(a,n,o,i,c,"throw",t)}i(void 0)}))},function(){return n.apply(this,arguments)})},{key:"renderEntries",value:function(t,e,r){var n=this,o=document.querySelector("#trackerTable tbody");o.innerHTML="",t.forEach((function(t){var a=n.createEntryRow(t,e,r);o.appendChild(a)}))}},{key:"addEntryRow",value:function(t,e,r){var n=document.querySelector("#trackerTable tbody"),o=this.createEntryRow(t,e,r);return n.appendChild(o),o}},{key:"createEntryRow",value:function(t,e,r){var n=document.createElement("tr");n.dataset.entryId=t.id;var o=e.map((function(e){return"<option ".concat(t.method===e?"selected":"",">").concat(e,"</option>")})).join(""),a=r.map((function(e){return"<option ".concat(t.company===e?"selected":"",">").concat(e,"</option>")})).join("");return n.innerHTML='\n      <td><span class="delete-btn">&times;</span></td>\n      <td><input type="date" value="'.concat(t.formattedDate||"",'"></td>\n      <td>\n        <select class="methodSelect">\n          <option value="" ').concat(""===t.method?"selected":"",">Select Method</option>\n          ").concat(o,'\n          <option>ADD METHOD</option>\n        </select>\n      </td>\n      <td><input type="text" value="').concat(t.location||"",'"></td>\n      <td><input type="number" min="0" step="0.1" value="').concat(t.hours||0,'"></td>\n      <td>\n        <select class="companySelect">\n          <option value="" ').concat(""===t.company?"selected":"",">Select Company</option>\n          ").concat(a,'\n          <option>ADD COMPANY</option>\n        </select>\n      </td>\n      <td><button class="signBtn">Request Signature</button></td>\n      <td class="hash-cell"></td>\n    '),n}},{key:"updateSignatures",value:function(t){var e=this;t.forEach((function(t){var r=P(document.querySelectorAll("#trackerTable tbody tr")).find((function(e){return e.dataset.entryId==t.entry_id}));if(r&&"Confirmed"===t.status){var n=r.querySelector("td:nth-child(7)");n&&(n.innerHTML='<span class="signature">'.concat(t.auto_signature,"</span>"));var o=r.querySelector("td:last-child");o&&t.timestamp_hash?o.innerHTML='<button class="verify-btn" data-signature="'.concat(t.id,'" \n            data-method="').concat(t.method,'" data-hours="').concat(t.hours,'" \n            data-hash="').concat(t.timestamp_hash,'">Verify</button>'):o&&(o.textContent="No hash available"),e.disableSignedRow(r)}}))}},{key:"updateMethodSelects",value:function(t){document.querySelectorAll(".methodSelect").forEach((function(e){for(var r=e.value;e.options.length>2;)e.remove(1);P(t).reverse().forEach((function(t){var r=document.createElement("option");r.value=t,r.text=t,e.insertBefore(r,e.options[1])})),t.includes(r)&&(e.value=r)})),this.currentMethodSelect&&(this.currentMethodSelect.value=t[t.length-1],this.updateTotals(),this.currentMethodSelect=null)}},{key:"updateCompanySelects",value:function(t){document.querySelectorAll(".companySelect").forEach((function(e){for(var r=e.value;e.options.length>2;)e.remove(1);P(t).reverse().forEach((function(t){var r=document.createElement("option");r.value=t,r.text=t,e.insertBefore(r,e.options[1])})),t.includes(r)&&(e.value=r)})),this.currentCompanySelect&&(this.currentCompanySelect.value=t[t.length-1],this.currentCompanySelect=null)}},{key:"updateTotals",value:function(){var t=document.querySelectorAll("#trackerTable tbody tr"),e=0,r={};t.forEach((function(t){var n=t.querySelector(".methodSelect"),o=t.querySelector('input[type="number"]');if(n&&o){var a=n.value,i=parseFloat(o.value)||0;a&&"ADD METHOD"!==a&&(e+=i,r[a]||(r[a]=0),r[a]+=i)}})),document.getElementById("totalHoursValue").textContent=e.toFixed(1);var n=document.querySelector("#methodTable tbody");for(var o in n.innerHTML="",r){var a=document.createElement("tr"),i=document.createElement("td");i.textContent=o;var c=document.createElement("td");c.textContent=r[o].toFixed(1),a.appendChild(i),a.appendChild(c),n.appendChild(a)}}},{key:"disableSignedRow",value:function(t){t.querySelectorAll("input, select").forEach((function(t){t.disabled=!0,t.classList.add("signed-field")})),t.classList.add("signed-row")}},{key:"enhanceResponsiveBehavior",value:function(){var t=function(){var t=window.innerWidth<=767;document.querySelectorAll("#trackerTable tbody tr").forEach((function(e){var r=e.querySelector(".delete-btn");r&&(t?r.closest("td").classList.add("delete-cell"):r.closest("td").classList.remove("delete-cell"))}))};if(t(),window.addEventListener("resize",t),this.eventHandlers.onAddLine){var e=this.eventHandlers.onAddLine;this.eventHandlers.onAddLine=function(){e.apply(void 0,arguments),setTimeout(t,100)}}}}],e&&M(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,B(n.key),n)}}function B(t){var e=function(t){if("object"!=A(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==A(e)?e:e+""}var F=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.entryManager=e},(e=[{key:"exportToPDF",value:function(){var t=new(0,window.jspdf.jsPDF);t.text("NDT HOURS TRACKER",10,10);var e=document.querySelectorAll("#trackerTable tbody tr"),r=[];e.forEach((function(t){var e,n=t.cells[1].querySelector("input").value,o=t.cells[2].querySelector("select").value,a=t.cells[3].querySelector("input").value,i=t.cells[4].querySelector("input").value,c=t.cells[5].querySelector("select").value,u=t.cells[6];e=u.querySelector("button")?"Pending Signature":u.textContent.trim(),(n||o||a||i||c||e)&&r.push([n,o,a,i,c,e])})),t.autoTable({head:[["DATE","METHOD","LOCATION","HOURS","COMPANY","SUPERVISOR"]],body:r,startY:20});var n=document.getElementById("totalHoursValue").textContent;t.text("Total Hours: ".concat(n),10,t.lastAutoTable.finalY+10);var o=document.querySelectorAll("#methodTable tbody tr"),a=[];o.forEach((function(t){var e=t.querySelectorAll("td"),r=e[0].textContent,n=e[1].textContent;a.push([r,n])})),t.autoTable({head:[["Method","Hours"]],body:a,startY:t.lastAutoTable.finalY+20});var i=(new Date).toLocaleDateString();t.setFontSize(10),t.text("Generated on ".concat(i),10,t.internal.pageSize.height-10),t.save("NDT_HOURS_TRACKER.pdf")}},{key:"exportToCSV",value:function(){}},{key:"exportToExcel",value:function(){}}])&&q(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function H(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function R(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?H(Object(r),!0).forEach((function(e){U(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function U(t,e,r){return(e=K(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function V(){V=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof m?e:m,i=Object.create(a.prototype),c=new _(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function b(){}var w={};s(w,i,(function(){return this}));var E=Object.getPrototypeOf,x=E&&E(E(C([])));x&&x!==r&&n.call(x,i)&&(w=x);var S=b.prototype=m.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==G(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(G(e)+" is not iterable")}return g.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},L(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(S),s(S,u,"Generator"),s(S,i,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Y(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function z(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){Y(a,n,o,i,c,"next",t)}function c(t){Y(a,n,o,i,c,"throw",t)}i(void 0)}))}}function J(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,K(n.key),n)}}function K(t){var e=function(t){if("object"!=G(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==G(e)?e:e+""}var W=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.uiManager=e,this.api=new i},e=[{key:"fetchEntries",value:(a=z(V().mark((function t(){var e,r;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.get("/api/rope-entries");case 3:if((e=t.sent).success){t.next=6;break}return t.abrupt("return",console.error("Fetch failed:",e.message));case 6:r=e.data.map((function(t){if(t.date_from){var e=new Date(t.date_from);isNaN(e.getTime())||(t.date_from=e.toISOString().split("T")[0])}if(t.date_to){var r=new Date(t.date_to);isNaN(r.getTime())||(t.date_to=r.toISOString().split("T")[0])}return t})),this.uiManager.renderEntries(r),this.uiManager.updateTotal(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.error("Fetch error:",t.t0);case 14:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(){return a.apply(this,arguments)})},{key:"addNewEntry",value:(o=z(V().mark((function t(){var e,r;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.post("/api/rope-entries",{date_from:null,date_to:null,company:"",location:"",tasks:"",industry:"",details:"",supervisor:"",rope_hours:0,signature_hash:""});case 3:(e=t.sent).success&&(r=R({id:e.insertedId},e.data),this.uiManager.addEntryRow(r),this.uiManager.updateTotal()),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Add error:",t.t0);case 10:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return o.apply(this,arguments)})},{key:"updateEntry",value:(n=z(V().mark((function t(e,r){var n,o;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=R({},r),console.log("Updating entry:",e,"with data:",n),t.next=5,this.api.put("/api/rope-entries/".concat(e),n);case 5:(o=t.sent).success||console.error("Update failed:",o.message),this.uiManager.updateTotal(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.error("Update error:",t.t0);case 13:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(t,e){return n.apply(this,arguments)})},{key:"deleteEntry",value:(r=z(V().mark((function t(e){return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&confirm("Delete this entry?")){t.next=2;break}return t.abrupt("return",!1);case 2:return t.prev=2,t.next=5,this.api.delete("/api/rope-entries/".concat(e));case 5:if(t.sent.success){t.next=8;break}return t.abrupt("return",alert("Failed to delete entry."));case 8:return this.uiManager.updateTotal(),t.abrupt("return",!0);case 12:return t.prev=12,t.t0=t.catch(2),console.error(t.t0),alert("Delete failed."),t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t,this,[[2,12]])}))),function(t){return r.apply(this,arguments)})},{key:"calculateTotal",value:function(){var t=document.querySelectorAll("#ropeTable tbody tr"),e=0;return t.forEach((function(t){var r=parseFloat(t.querySelector('input[type="number"]').value)||0;e+=r})),e}}],e&&J(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,a}();function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function X(){X=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof m?e:m,i=Object.create(a.prototype),c=new _(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function b(){}var w={};s(w,i,(function(){return this}));var E=Object.getPrototypeOf,x=E&&E(E(C([])));x&&x!==r&&n.call(x,i)&&(w=x);var S=b.prototype=m.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==$(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError($(e)+" is not iterable")}return g.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},L(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(S),s(S,u,"Generator"),s(S,i,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Z(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function tt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){Z(a,n,o,i,c,"next",t)}function c(t){Z(a,n,o,i,c,"throw",t)}i(void 0)}))}}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rt(n.key),n)}}function rt(t){var e=function(t){if("object"!=$(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=$(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$(e)?e:e+""}var nt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.entryManager=e,this.tableBody=document.querySelector("#ropeTable tbody"),this.totalHoursDisplay=document.querySelector("#totalRopeHoursValue"),this.init()},e=[{key:"init",value:function(){var t=this;document.getElementById("addRopeLineBtn").addEventListener("click",(function(){t.entryManager.addNewEntry()})),document.addEventListener("click",(function(t){t.target.closest(".verification-modal .close")&&(document.getElementById("ropeVerificationModal").style.display="none"),t.target.classList.contains("verification-modal")&&(t.target.style.display="none")}))}},{key:"renderEntries",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.tableBody.innerHTML="",e.forEach((function(e){return t.addEntryRow(e)})),this.signatureManager&&this.signatureManager.refreshSignatures()}},{key:"addEntryRow",value:function(t){var e=this,r=document.createElement("tr");r.dataset.entryId=t.id,console.log("Adding row with entry:",t),r.innerHTML='\n      <td><span class="delete-btn">&times;</span></td>\n      <td><input type="date" value="'.concat(t.date_from||"",'"></td>\n      <td><input type="date" value="').concat(t.date_to||"",'"></td>\n      <td><input type="text" value="').concat(t.company||"",'"></td>\n      <td><input type="text" value="').concat(t.location||"",'"></td>\n      <td><input type="text" value="').concat(t.tasks||"",'"></td>\n      <td><input type="text" value="').concat(t.industry||"",'"></td>\n      <td><input type="text" value="').concat(t.details||"",'"></td>\n      <td><input type="text" value="').concat(t.supervisor||"",'"></td>\n      <td><input type="number" min="0" step="0.1" value="').concat(t.rope_hours||0,'"></td>\n      <td><button class="signBtn">Request Signature</button></td>\n      <td class="hash-cell">').concat(t.signature_hash||"","</td>\n    "),r.querySelector(".delete-btn").addEventListener("click",tt(X().mark((function n(){return X().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.entryManager.deleteEntry(t.id);case 2:n.sent&&r.remove();case 4:case"end":return n.stop()}}),n)})))),r.querySelectorAll("input").forEach((function(n){n.addEventListener("change",(function(){if(r.classList.contains("signed-row"))return alert("This entry has been signed and cannot be modified."),void(n.value=n.defaultValue);var o=e.getRowData(r);console.log("Input changed, saving data:",o),e.entryManager.updateEntry(t.id,o)}))})),this.tableBody.appendChild(r),r.querySelector(".signBtn").addEventListener("click",(function(){e.signatureManager?e.signatureManager.openSignatureModal(t.id):console.warn("signatureManager not found")}))}},{key:"updateTotal",value:function(){var t=this.entryManager.calculateTotal();this.totalHoursDisplay.textContent=t.toFixed(1)}},{key:"getRowData",value:function(t){var e=t.querySelectorAll("input");return{date_from:e[0].value||null,date_to:e[1].value||null,company:e[2].value,location:e[3].value,tasks:e[4].value,industry:e[5].value,details:e[6].value,supervisor:e[7].value,rope_hours:parseFloat(e[8].value)||0,signature_hash:t.querySelector(".hash-cell").textContent}}},{key:"updateSignatures",value:function(t){var e=this;t.forEach((function(t){var r=function(t){return function(t){if(Array.isArray(t))return Q(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Q(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(document.querySelectorAll("#ropeTable tbody tr")).find((function(e){return e.dataset.entryId==t.entry_id}));if(r&&"Confirmed"===t.status){var n=r.querySelector("td:nth-child(11)");n&&(n.innerHTML='<span class="signature">'.concat(t.auto_signature,"</span>"));var o=r.querySelector("td:last-child");if(o&&t.timestamp_hash){o.innerHTML='<button class="verify-btn" data-signature="'.concat(t.id,'" \n            data-tasks="').concat(t.tasks||"",'" data-hours="').concat(t.rope_hours||0,'" \n            data-hash="').concat(t.timestamp_hash,'">Verify</button>');var a=o.querySelector(".verify-btn");a.addEventListener("click",(function(){e.signatureManager&&e.signatureManager.showVerificationDetails({signatureId:t.id,tasks:a.getAttribute("data-tasks"),hours:a.getAttribute("data-hours"),supervisor:r.querySelector('input[type="text"]:nth-of-type(8)').value,timestampHash:a.getAttribute("data-hash")})}))}else o&&(o.textContent="No hash available");e.disableSignedRow(r)}}))}},{key:"disableSignedRow",value:function(t){t.querySelectorAll("input").forEach((function(t){t.disabled=!0,t.classList.add("signed-field"),t.defaultValue=t.value})),t.classList.add("signed-row")}}],e&&et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function at(){at=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var a=e&&e.prototype instanceof m?e:m,i=Object.create(a.prototype),c=new _(n||[]);return o(i,"_invoke",{value:O(t,r,c)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function m(){}function g(){}function b(){}var w={};s(w,i,(function(){return this}));var E=Object.getPrototypeOf,x=E&&E(E(C([])));x&&x!==r&&n.call(x,i)&&(w=x);var S=b.prototype=m.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,a,i,c){var u=f(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==ot(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,c)}),(function(t){r("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return r("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,r,n){var o=h;return function(a,i){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(ot(e)+" is not iterable")}return g.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},L(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new k(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(S),s(S,u,"Generator"),s(S,i,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function it(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ct(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){it(a,n,o,i,c,"next",t)}function c(t){it(a,n,o,i,c,"throw",t)}i(void 0)}))}}function ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,st(n.key),n)}}function st(t){var e=function(t){if("object"!=ot(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ot(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ot(e)?e:e+""}var lt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.api=new i,this.uiManager=e,this.initModal()},e=[{key:"initModal",value:function(){var t=this;this.modal=document.getElementById("ropeSignatureModal"),this.form=document.getElementById("ropeSignatureForm"),this.closeBtn=this.modal.querySelector(".close"),this.form.addEventListener("submit",(function(e){e.preventDefault(),t.requestSignature()})),this.closeBtn.addEventListener("click",(function(){t.modal.style.display="none"}))}},{key:"openSignatureModal",value:function(t){this.currentEntryId=t,this.modal.style.display="block"}},{key:"requestSignature",value:(o=ct(at().mark((function t(){var e,r,n,o,a,i,c,u,s;return at().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=this.form.supervisorName.value,a=this.form.supervisorEmail.value,i=(null===(e=this.form.supervisorCompany)||void 0===e?void 0:e.value)||"",c=(null===(r=this.form.asnt)||void 0===r?void 0:r.value)||"",u=(null===(n=this.form.certLevel)||void 0===n?void 0:n.value)||"",t.prev=5,t.next=8,this.api.post("/api/rope-signatures/request",{entryId:this.currentEntryId,supervisorName:o,supervisorEmail:a,supervisorCompany:i,asnt:c,certLevel:u});case 8:(s=t.sent).success?(alert("Signature request sent! The supervisor will receive an email with verification instructions."),this.modal.style.display="none"):alert("Request failed: "+s.message),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(5),console.error(t.t0),alert("Something went wrong. Try again.");case 16:case"end":return t.stop()}}),t,this,[[5,12]])}))),function(){return o.apply(this,arguments)})},{key:"refreshSignatures",value:(n=ct(at().mark((function t(){var e,r;return at().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.api.get("/api/rope-signatures");case 3:if((e=t.sent).success){t.next=7;break}return console.error("Error fetching signatures:",e.message),t.abrupt("return");case 7:r=e.data||[],console.log("Received rope signatures:",r),this.uiManager.updateSignatures(r),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error refreshing signatures:",t.t0);case 15:case"end":return t.stop()}}),t,this,[[0,12]])}))),function(){return n.apply(this,arguments)})},{key:"showVerificationDetails",value:(r=ct(at().mark((function t(e){var r,n,o,a,i,c,u,s,l;return at().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.signatureId,n=e.tasks,o=e.hours,a=e.supervisor,i=e.timestampHash,(c=document.getElementById("ropeVerificationModal"))||(c=this.createVerificationModal()),document.getElementById("verifyTasks").textContent=n,document.getElementById("verifyHours").textContent=o,document.getElementById("verifySupervisor").textContent=a,document.getElementById("verifyDate").textContent="Loading...",document.getElementById("verifyHash").textContent=i||"No hash available",c.style.display="block",!r){t.next=21;break}return t.prev=10,t.next=13,this.api.get("/api/rope-signatures/verify/".concat(r));case 13:(u=t.sent).success&&(document.getElementById("verifyDate").textContent=new Date(u.verification_date).toLocaleDateString(),(s=document.getElementById("verifyCertInfo"))&&(l="",u.cert_number&&(l+="Certification Number: ".concat(u.cert_number)),u.cert_level&&(l+=l?", ":"",l+="Level: ".concat(u.cert_level)),s.textContent=l||"No certification information provided")),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(10),console.error("Error fetching verification details:",t.t0),document.getElementById("verifyDate").textContent="Date unavailable";case 21:case"end":return t.stop()}}),t,this,[[10,17]])}))),function(t){return r.apply(this,arguments)})},{key:"createVerificationModal",value:function(){var t=document.createElement("div");return t.id="ropeVerificationModal",t.className="verification-modal",t.innerHTML='\n      <div class="verification-modal-content">\n        <span class="close">&times;</span>\n        <h2>Rope Access Verification Details</h2>\n        <div class="verification-details">\n          <p><strong>Tasks:</strong> <span id="verifyTasks"></span></p>\n          <p><strong>Hours:</strong> <span id="verifyHours"></span></p>\n          <p><strong>Supervisor:</strong> <span id="verifySupervisor"></span></p>\n          <p><strong>Verification Date:</strong> <span id="verifyDate"></span></p>\n          <p><strong>Certification:</strong> <span id="verifyCertInfo"></span></p>\n          <p><strong>Cryptographic Hash:</strong></p>\n          <div class="hash-display" id="verifyHash"></div>\n        </div>\n        <p>This verification is tamper-proof and timestamped to ensure the integrity of this certification record.</p>\n      </div>\n    ',t.querySelector(".close").addEventListener("click",(function(){t.style.display="none"})),t.addEventListener("click",(function(e){e.target===t&&(t.style.display="none")})),document.body.appendChild(t),t}}],e&&ut(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o}();document.addEventListener("DOMContentLoaded",(function(){var t=window.location.pathname;if("/tracker"===t){var e=new D,r=new m(e),n=new j(e),o=new F(r);e.initializeEventListeners({onAddLine:r.addNewEntry.bind(r),onDeleteEntry:r.deleteEntry.bind(r),onUpdateEntry:r.updateEntry.bind(r),onRequestSignature:n.openSignatureModal.bind(n),onSubmitSignature:n.requestSignature.bind(n),onVerifySignature:n.showVerificationDetails.bind(n),onExportPDF:o.exportToPDF.bind(o),onRefreshSignatures:n.refreshSignatures.bind(n),onAddMethod:r.addMethod.bind(r),onAddCompany:r.addCompany.bind(r),onLogout:function(){window.location.href="/logout"}}),r.fetchMethods(),r.fetchCompanies(),r.fetchEntries(),e.fetchUserInfo(),e.enhanceResponsiveBehavior(),n.refreshSignatures()}else if("/rope"===t){var a=new nt,i=new W(a),c=new lt(a);a.entryManager=i,a.signatureManager=c;var u=document.getElementById("refreshRopeSignaturesBtn");u&&u.addEventListener("click",(function(){c.refreshSignatures()})),i.fetchEntries(),c.refreshSignatures(),window.ropeApp={ui:a,entryManager:i,signatureManager:c}}}))})();
//# sourceMappingURL=bundle.js.map